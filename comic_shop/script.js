const books = [

    {
        id: "0",
        genre: "fantasy",
        title: "Solo Leveling 1",
        Img: 'https://m.media-amazon.com/images/I/51HmXzAbsOL._SY445_SX342_.jpg',
        price: 16,
        suggestion: "Solo Leveling 2"
    },

    {
        id: "1",
        genre: "fantasy",
        title: "Solo Leveling 2",
        Img: 'https://m.media-amazon.com/images/I/81ZAC67DE1S._SY425_.jpg',
        price: 12,
        suggestion: "Solo Leveling 3"
    },

    {
        id: "2",
        genre: "fantasy",
        title: "Solo Leveling 3",
        Img: 'https://m.media-amazon.com/images/I/71goH8p2ENL._SY425_.jpg',
        price: 20,
        suggestion: "Solo Leveling 4"
    },

    {
        id: "3",
        genre: "fantasy",
        title: "Solo Leveling 4",
        Img: 'https://m.media-amazon.com/images/I/81shyf5cV9L._SY425_.jpg',
        price: 15,
        suggestion: "Solo Leveling 5"
    },

    {
        id: "4",
        genre: "fantasy",
        title: "Solo Leveling 5",
        Img: 'https://m.media-amazon.com/images/I/81eln1SzG7L._SY425_.jpg',
        price: 15,
        suggestion: "Solo Leveling 6"
    },

    {
        id: "5",
        genre: "fantasy",
        title: "Solo Leveling 6",
        Img: 'https://m.media-amazon.com/images/I/81v0cDv9IfL._SY425_.jpg',
        price: 20,
        suggestion: "Solo Leveling 7"
    },

    {
        id: "6",
        genre: "fantasy",
        title: "Solo Leveling 7",
        Img: 'https://m.media-amazon.com/images/I/51sgPH9I1oL._SY445_SX342_.jpg',
        price: 15,
        suggestion: "Solo Leveling 8"
    },

    {
        id: "7",
        genre: "fantasy",
        title: "Solo Leveling 8",
        Img: 'https://m.media-amazon.com/images/I/81OYRZEQG7L._SY425_.jpg',
        price: 20,
        suggestion: "Solo Leveling 9"
    },

    {
        id: "8",
        genre: "fantasy",
        title: "Solo Leveling 9",
        Img: 'https://m.media-amazon.com/images/I/91-juYmiUrL._SY425_.jpg',
        price: 20,
        suggestion: "Solo Leveling 10"
    },

    {
        id: "9",
        genre: "fantasy",
        title: "Solo Leveling 10",
        Img: 'https://m.media-amazon.com/images/I/7142PfvTN8L._SY425_.jpg',
        price: 20,
        suggestion: "Solo Leveling 11"
    },

    {
        id: "10",
        genre: "fantasy",
        title: "Solo Leveling 11",
        Img: 'https://m.media-amazon.com/images/I/81TDZ0NMr9L._SY425_.jpg',
        price: 20,
        suggestion: "Solo Leveling 12"
    },

    {
        id: "11",
        genre: "fantasy",
        title: "Solo Leveling 12",
        Img: 'https://m.media-amazon.com/images/I/81djsCmPUOL._SY425_.jpg',
        price: 18,
        suggestion: "Blue Exorcist 1"
    },

    {
        id: "12",
        genre: "romance",
        title: "Heartstopper 1",
        Img: 'https://m.media-amazon.com/images/I/51RlLjRRJZL._SY445_SX342_.jpg',
        price: 19,
        suggestion: "Heartstopper 2"
    },

    {
        id: "13",
        genre: "romance",
        title: "Heartstopper 2",
        Img: 'https://m.media-amazon.com/images/I/818-rhaINAL._SY466_.jpg',
        price: 13,
        suggestion: "Heartstopper 3"
    },

    {
        id: "14",
        genre: "romance",
        title: "Heartstopper 3",
        Img: 'https://m.media-amazon.com/images/I/71TJgLmYmmL._SY466_.jpg',
        price: 13,
        suggestion: "Heartstopper 4"
    },

    {
        id: "15",
        genre: "romance",
        title: "Heartstopper 4",
        Img: 'https://m.media-amazon.com/images/I/815phxYRsVL._SY466_.jpg',
        price: 15,
        suggestion: "Heartstopper 5"
    },

    {
        id: "16",
        genre: "romance",
        title: "Heartstopper 5",
        Img: 'https://m.media-amazon.com/images/I/81sOyKYZVDL._SY466_.jpg',
        price: 12,
        suggestion: "???"
    },

    {
        id: "17",
        genre: "romance",
        title: "your name. 1",
        Img: 'https://m.media-amazon.com/images/I/71YoxjSxCEL._SY466_.jpg',
        price: 10,
        suggestion: "Your Name 2"
    },

    {
        id: "18",
        genre: "romance",
        title: "your name. 2",
        Img: 'https://m.media-amazon.com/images/I/41jzvQGzI5L._SY445_SX342_.jpg',
        price: 11,
        suggestion: "Your Name 3"
    },

    {
        id: "19",
        genre: "romance",
        title: "your name. 3",
        Img: 'https://m.media-amazon.com/images/I/41QR2mlY5rL._SY445_SX342_.jpg',
        price: 10,
        suggestion: "Heartstopper 1"
    },

    {
        id: "20",
        genre: "fantasy",
        title: "Fullmetal Alchemist 1",
        Img: 'https://m.media-amazon.com/images/I/51EfKfNqnQL._SY445_SX342_.jpg',
        price: 18,
        suggestion: "Heartstopper 5"
    },

    {
        id: "21",
        genre: "fantasy",
        title: "Fullmetal Alchemist 2",
        Img: 'https://m.media-amazon.com/images/I/515xbUHEG7L._SY445_SX342_.jpg',
        price: 16,
        suggestion: "???"
    },

    {
        id: "2",
        genre: "fantasy",
        title: "Fullmetal Alchemist 3",
        Img: 'https://m.media-amazon.com/images/I/71lBp1jYeTL._SY425_.jpg',
        price: 19,
        suggestion: "Heartstopper 2"
    },

    {
        id: "23",
        genre: "fantasy",
        title: "Fullmetal Alchemist 4",
        Img: 'https://m.media-amazon.com/images/I/71J08lvlisL._SY466_.jpg',
        price: 23,
        suggestion: "Heartstopper 3"
    },

    {
        id: "24",
        genre: "fantasy",
        title: "Fullmetal Alchemist 5",
        Img: 'https://m.media-amazon.com/images/I/51w99EDcq4L._SY445_SX342_.jpg',
        price: 19,
        suggestion: "Heartstopper 4"
    },

    {
        id: "25",
        genre: "fantasy",
        title: "Fullmetal Alchemist 6",
        Img: 'https://m.media-amazon.com/images/I/71xOnCxDTgL._SY425_.jpg',
        price: 16,
        suggestion: "Heartstopper 5"
    },

    {
        id: "26",
        genre: "fantasy",
        title: "Fullmetal Alchemist 7",
        Img: 'https://m.media-amazon.com/images/I/71DpjC1R4nL._SY466_.jpg',
        price: 18,
        suggestion: "???"
    },

    {
        id: "27",
        genre: "fantasy",
        title: "Fullmetal Alchemist 8",
        Img: 'https://m.media-amazon.com/images/I/511cn1DWh8L._SY445_SX342_.jpg',
        price: 16,
        suggestion: "???"
    },

    {
        id: "28",
        genre: "fantasy",
        title: "Fullmetal Alchemist 9",
        Img: 'https://m.media-amazon.com/images/I/71ZydMXuyEL._SY466_.jpg',
        price: 20,
        suggestion: "???"
    },

    {
        id: "29",
        genre: "fantasy",
        title: "Fullmetal Alchemist 10",
        Img: 'https://m.media-amazon.com/images/I/41uzVmM1GBL._SY445_SX342_.jpg',
        price: 18,
        suggestion: "???"
    },

    {
        id: "30",
        genre: "fantasy",
        title: "Fullmetal Alchemist 11",
        Img: 'https://m.media-amazon.com/images/I/51RUNoAvz9L._SY445_SX342_.jpg',
        price: 17,
        suggestion: "???"
    },

    {
        id: "31",
        genre: "fantasy",
        title: "Fullmetal Alchemist 12",
        Img: 'https://m.media-amazon.com/images/I/51xQesEYzNL._SY445_SX342_.jpg',
        price: 19,
        suggestion: "???"
    },

    {
        id: "32",
        genre: "fantasy",
        title: "Fullmetal Alchemist 13",
        Img: 'https://m.media-amazon.com/images/I/51O54wvgjKL._SY445_SX342_.jpg',
        price: 12,
        suggestion: "???"
    },

    {
        id: "33",
        genre: "fantasy",
        title: "Fullmetal Alchemist 14",
        Img: 'https://m.media-amazon.com/images/I/41CVpKhPGpS._SY445_SX342_.jpg',
        price: 16,
        suggestion: "???"
    },

    {
        id: "34",
        genre: "fantasy",
        title: "Fullmetal Alchemist 15",
        Img: 'https://m.media-amazon.com/images/I/51mOt6aZocL._SY445_SX342_.jpg',
        price: 16,
        suggestion: "???"
    },

    {
        id: "35",
        genre: "fantasy",
        title: "Fullmetal Alchemist 16",
        Img: 'https://m.media-amazon.com/images/I/71r9+m6-W3L._SY425_.jpg',
        price: 14,
        suggestion: "???"
    },

    {
        id: "36",
        genre: "fantasy",
        title: "Fullmetal Alchemist 17",
        Img: 'https://m.media-amazon.com/images/I/81K6-drsolL._SY425_.jpg',
        price: 23,
        suggestion: "???"
    },

    {
        id: "37",
        genre: "fantasy",
        title: "Fullmetal Alchemist 18",
        Img: 'https://m.media-amazon.com/images/I/51eQ2NpHh7L._SY445_SX342_.jpg',
        price: 17,
        suggestion: "???"
    },

    {
        id: "38",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 1",
        Img: 'https://m.media-amazon.com/images/I/81sphDUj6aS._SY466_.jpg',
        price: 10,
        suggestion: "???"
    },

    {
        id: "39",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 2",
        Img: 'https://m.media-amazon.com/images/I/81pv0TZU4sL._SY466_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "40",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 3",
        Img: 'https://m.media-amazon.com/images/I/91Ao6ILdigL._SY466_.jpg',
        price: 9,
        suggestion: "???"
    },

    {
        id: "41",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 4",
        Img: 'https://m.media-amazon.com/images/I/81Pfz3qUu7L._SY466_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "42",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 5",
        Img: 'https://m.media-amazon.com/images/I/51fXL9FCf1L._SY445_SX342_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "43",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 6",
        Img: 'https://m.media-amazon.com/images/I/81hUX5XSZ1L._SY466_.jpg',
        price: 10,
        suggestion: "???"
    },

    {
        id: "44",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 7",
        Img: 'https://m.media-amazon.com/images/I/81zcbF2CdwL._SY466_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "45",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 8",
        Img: 'https://m.media-amazon.com/images/I/91Npx-joNmL._SY466_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "46",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 9",
        Img: 'https://m.media-amazon.com/images/I/51cavNByn9L._SY445_SX342_.jpg',
        price: 9,
        suggestion: "???"
    },

    {
        id: "47",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 10",
        Img: 'https://m.media-amazon.com/images/I/61OiDfynaWL._SY445_SX342_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "48",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 11",
        Img: 'https://m.media-amazon.com/images/I/91JAwsp56WL._SY466_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "49",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 12",
        Img: 'https://m.media-amazon.com/images/I/91TBBeXpdbL._SY466_.jpg',
        price: 9,
        suggestion: "???"
    },

    {
        id: "50",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 13",
        Img: 'https://m.media-amazon.com/images/I/81DpNu1OsxL._SY466_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "51",
        genre: "fantasy",
        title: "Frieren: Beyond Journey's End 14",
        Img: 'https://us.oricon-group.com/upimg/detail/3000/3852/img660/frieren-volume-14-cover.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "52",
        genre: "music",
        title: "Bocchi the Rock! 1",
        Img: 'https://m.media-amazon.com/images/I/81DubR7340L._SY425_.jpg',
        price: 13,
        suggestion: "???"
    },

    {
        id: "53",
        genre: "music",
        title: "Bocchi the Rock! 2",
        Img: 'https://m.media-amazon.com/images/I/513dZP4KtpL._SY445_SX342_.jpg',
        price: 13,
        suggestion: "???"
    },

    {
        id: "54",
        genre: "music",
        title: "Bocchi the Rock! 3",
        Img: 'https://m.media-amazon.com/images/I/51KSD5lfOsL._SY445_SX342_.jpg',
        price: 12,
        suggestion: "???"
    },

    {
        id: "55",
        genre: "music",
        title: "Bocchi the Rock! 4",
        Img: 'https://m.media-amazon.com/images/I/51jATq+mVJL._SY445_SX342_.jpg',
        price: 13,
        suggestion: "???"
    },

    {
        id: "56",
        genre: "music",
        title: "Bocchi the Rock! 5",
        Img: 'https://m.media-amazon.com/images/I/51uQd-wexLL._SY445_SX342_.jpg',
        price: 11,
        suggestion: "???"
    },

    {
        id: "57",
        genre: "music",
        title: "Bocchi the Rock! 6",
        Img: 'https://m.media-amazon.com/images/I/51QD7UPfWEL._SY445_SX342_.jpg',
        price: 13,
        suggestion: "???"
    },

    {
        id: "58",
        genre: "music",
        title: "Bocchi the Rock! 7",
        Img: 'https://m.media-amazon.com/images/I/515EfzFe6cL._SY445_SX342_.jpg',
        price: 15,
        suggestion: "???"
    },
];

let catalogGenre = "all books";
let totalItems = 0;
let subtotal = 0;
let maxItemPrice = 0;
let discount = 0;
let recommendations = [];
let cart = [];
let pageAmount = books.length / 12;
let firsComicCardId = 0;
let LastComicCardId = 0;
let dividelist = [];

// console.log();
// alert("I am an alert")
// var person = prompt("Please enter your name", "Harry Potter");

let dropdownActiv = false;
function dropdownGenreBtn() {
    if (dropdownActiv === false) {
        document.getElementById('genreBtnContainer').style.display = 'block';
        const elements = document.getElementsByClassName('genreBtn');
        for (let i = 0; i < elements.length; i++) {
            elements[i].style.display = 'inline-block';
        }
        dropdownActiv = true;
    } else if (dropdownActiv === true) {
        document.getElementById('genreBtnContainer').style.display = 'none';
        const elements = document.getElementsByClassName('genreBtn');
        for (let i = 0; i < elements.length; i++) {
            elements[i].style.display = 'none';
        }
        dropdownActiv = false;
    }
}


function divideToGenres(genre) {
    dividelist.length = 0;
    for (let x = 0; x < books.length; x++) {
        let itemGenre = books[x].genre;
        if (genre === itemGenre | genre === 'all books') {
            dividelist.push(books[x]);
        }

    }
}

function createPageBtns(genre) {
    document.getElementById('pageBtnsContainer').replaceChildren();
    divideToGenres(genre);
    if (genre === 'all books') {
        pageAmount = books.length / 12;
    } else {
        pageAmount = dividelist.length / 12;
    }

    for (let y = 0; y < pageAmount; y++) {
        const pageBtn = document.createElement('section');
        // item.className = 'comicCard';
        pageBtn.innerHTML = `
            <button type="button" class="pageBtn" onclick="printComicCards('${genre}',${y})">${y + 1}</button>
        `;
        document.getElementById('pageBtnsContainer').appendChild(pageBtn);
    }
}

function dividePages(page) {
    if (page === 0) {
        firsComicCardId = 0;
        LastComicCardId = 12;
    } else {
        firsComicCardId = page * 12;
        LastComicCardId = (page + 1) * 12;
    }
}

function printComicCards(Genre, page) {
    window.scrollTo({
        top: 0,
        left: 0,
        behavior: "smooth",
    });
    document.getElementById('catalogPage').replaceChildren();
    createPageBtns(Genre);
    dividePages(page);
    divideToGenres(Genre);
    console.log(dividelist);
    for (let x = firsComicCardId; x < LastComicCardId; x++) {
        if (x === dividelist.length) { break }
        const item = document.createElement('section');
        item.className = 'comicCard';
        const id_quantity = books.indexOf(dividelist[x]);
        console.log(books.indexOf(dividelist[x]));
        item.innerHTML = `
                <img class="comicImage" src="${dividelist[x].Img}">
                <h2 class="itemName">${dividelist[x].title}</h2>
                <p class="price">${dividelist[x].price}$</p>
                <label for="${id_quantity}">quantity(0-10)</label>
                <input type="number" class="quantity" id="${id_quantity}" value="1" min="1" max="10" />
                <button type="button" onclick="addToCart(${books.indexOf(dividelist[x])}, document.getElementById('${id_quantity}').value)">Add to
                    cart</button>    
            
        `;
        document.getElementById('catalogPage').appendChild(item);

    }

}


printComicCards(catalogGenre, 0)


function addToCart(itemId_str, quantity_str) {
    // console.log("added to cart:")
    // console.log(books[itemId].title)
    // console.log("quantity: ", quantity)
    const itemId = parseInt(itemId_str);
    const price = books[itemId].price;
    const quantity = parseInt(quantity_str)

    let found = false;
    // If item already exists in cart, update quantity
    // Otherwise, add new item to cart
    for (let i = 0; i < cart.length; i++) {
        if (cart[i].id === itemId) {
            cart[i].quantity += quantity;
            found = true;
            break;
        }
    }

    if (found === false) {
        cart.push({
            id: itemId,
            title: books[itemId].title,
            price: price,
            quantity: quantity
        });

        recommendations.push(books[itemId].suggestion)
    }

    totalItems += quantity;
    subtotal += price * quantity;
    if (maxItemPrice < price) {
        maxItemPrice = price;
    }
    document.getElementById('cartCount').textContent = totalItems;


    console.log("Max Item Price: ", maxItemPrice);
    console.log("subtotal: ", subtotal);
    console.log(cart)
    console.log(recommendations)

    if (totalItems >= 10 && alreadyShown === false) {
        document.getElementById('giftImg').style.display = 'inline-block';
    } else {
        document.getElementById('giftImg').style.display = 'none';
    }

}

let alreadyShown = false;

function removeGiftImg() {
    document.getElementById('giftImg').style.display = 'none';
    alreadyShown = true;
}

// Show cart page
function showCart() {
    if (totalItems > 0) {
        document.getElementById('catalogPage').style.display = 'none';
        document.getElementById('pageBtnsContainer').style.display = 'none';
        document.getElementById('chooseGenre').style.display = 'none';
        document.getElementById('cartPage').style.display = 'block';
        renderCart();
    } else {
        window.alert("there are no items in the cart. Please add items before entering the cart")
    }
}


function showCatalog() {
    document.getElementById('cartPage').style.display = 'none';
    document.getElementById('catalogPage').style.display = 'grid';
    document.getElementById('pageBtnsContainer').style.display = 'flex';
    document.getElementById('chooseGenre').style.display = 'block';
}

let randomDiscount = Math.floor(Math.random() * (50 - 0 + 1));

// Render cart items
function renderCart() {
    const cartItemsElement = document.getElementById('cartItems');
    const cartSubtotalElement = document.getElementById('cartSubtotal');
    const cartDiscount1Element = document.getElementById('cartDiscount1');
    const cartDiscount2Element = document.getElementById('cartDiscount2');
    const cartDiscount3Element = document.getElementById('cartDiscount3');
    const cartFinalPriceElement = document.getElementById('cartFinalPrice');
    const cartrecommendationsElement = document.getElementById('cartrecommendations');

    cartItemsElement.innerHTML = '';

    let bonusDiscountQuantity = 0; //number of books in cart that are higher than 11$
    let cheapestBonusItem = maxItemPrice + 10;

    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;

        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
            <div>
                <strong>${item.title}</strong><br>
                $${item.price.toFixed(2)} each
            </div>
            <div>
                Qty: ${item.quantity} | $${itemTotal.toFixed(2)}
            </div>
        `;
        cartItemsElement.appendChild(cartItem);

        if (item.price >= 11) {
            bonusDiscountQuantity += item.quantity;
            if (item.price < cheapestBonusItem) {
                cheapestBonusItem = item.price;
            }
        }
        console.log("bonusDiscountQuantity: " + bonusDiscountQuantity);
        console.log("cheapestBonusItem:" + cheapestBonusItem);
    });

    cartSubtotalElement.innerHTML = `Subtotal: $${subtotal.toFixed(2)}`;
    let discount = maxItemPrice / 10.0 + randomDiscount;
    cartDiscount1Element.innerHTML = `10%  Discount on most expensive item: -$${maxItemPrice / 10.0.toFixed(2)}`;
    cartDiscount3Element.innerHTML = `Random Discount: ${randomDiscount.toFixed(0)}%`;
    if (bonusDiscountQuantity >= 3) {
        cartDiscount2Element.innerHTML = `Free Book(bonus discount): -$${cheapestBonusItem.toFixed(2)}`;
        cartDiscount2Element.style.display = 'block';
        discount = maxItemPrice / 10.0 + randomDiscount + cheapestBonusItem;
    } else { cartDiscount2Element.style.display = 'none'; }
    cartFinalPriceElement.innerHTML = `Final Price: $${(subtotal - discount).toFixed(2)}`;
    cartrecommendationsElement.innerHTML = `You might also like: ${recommendations}`;

}

